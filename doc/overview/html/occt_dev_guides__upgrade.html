<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Open CASCADE Technology: Upgrade from older OCCT versions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="occ_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open CASCADE Technology
   &#160;<span id="projectnumber">7.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('occt_dev_guides__upgrade.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Upgrade from older OCCT versions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#upgrade_intro">Introduction</a><ul><li class="level2"><a href="#upgrade_intro_precautions">Precautions</a></li>
<li class="level2"><a href="#upgrade_intro_disclaim">Disclaimer</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_65">Upgrade to OCCT 6.5.0</a></li>
<li class="level1"><a href="#upgrade_651">Upgrade to OCCT 6.5.1</a></li>
<li class="level1"><a href="#upgrade_652">Upgrade to OCCT 6.5.2</a></li>
<li class="level1"><a href="#upgrade_653">Upgrade to OCCT 6.5.3</a></li>
<li class="level1"><a href="#upgrade_654">Upgrade to OCCT 6.5.4</a></li>
<li class="level1"><a href="#upgrade_660">Upgrade to OCCT 6.6.0</a></li>
<li class="level1"><a href="#upgrade_670">Upgrade to OCCT 6.7.0</a><ul><li class="level2"><a href="#upgrade_670_clipping">Object-level clipping and capping algorithm.</a></li>
<li class="level2"><a href="#upgrade_670_markers">Redesign of markers presentation</a></li>
<li class="level2"><a href="#upgrade_670_views">Default views are not created automatically</a></li>
<li class="level2"><a href="#upgrade_670_dimensions">Improved dimensions implementation</a></li>
<li class="level2"><a href="#upgrade_670_list_collection">NCollection_Set replaced by List collection</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_680">Upgrade to OCCT 6.8.0</a><ul><li class="level2"><a href="#upgrade_680_ncollection">Changes in NCollection classes</a></li>
<li class="level2"><a href="#upgrade_680_view_camera">3D View Camera</a></li>
<li class="level2"><a href="#upgrade_680_connected_objects">Redesign of Connected Interactive Objects</a></li>
<li class="level2"><a href="#upgrade_680_unicode">Support of UNICODE Characters</a></li>
<li class="level2"><a href="#upgrade_680_projection_shift">Elimination of Projection Shift Concept</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_690">Upgrade to OCCT 6.9.0</a><ul><li class="level2"><a href="#upgrade_690_selection">Changes in Selection</a></li>
<li class="level2"><a href="#upgrade_690_adaptor3d-curve">Changes in Adaptor3d_Curve class</a></li>
<li class="level2"><a href="#upgrade_690_v3d_view">Changes in V3d_View class</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_700">Upgrade to OCCT 7.0.0</a><ul><li class="level2"><a href="#upgrade_700_persist">Removal of legacy persistence</a></li>
<li class="level2"><a href="#upgrade_occt700_cdl">Removal of CDL and WOK</a><ul><li class="level3"><a href="#upgrade_occt700_cdl_auto">Automatic upgrade</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_compiler">Possible compiler errors</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_runtime">Possible runtime problems</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_nocast">Option to avoid cast of handle to reference to base type</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_compat">Preserving compatibility with OCCT 6.x</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_wok">Applications based on CDL and WOK</a></li>
</ul>
</li>
<li class="level2"><a href="#upgrade_occt700_bspline">Separation of BSpline cache</a></li>
<li class="level2"><a href="#upgrade_occt700_booleanresult">Structural result of Boolean operations</a></li>
<li class="level2"><a href="#upgrade_occt700_brepextrema">BRepExtrema_ExtCC finds one solution only</a></li>
<li class="level2"><a href="#upgrade_occt700_sorttools">Removal of SortTools package</a></li>
<li class="level2"><a href="#upgrade_occt700_2dlayers">On-screen objects and ColorScale</a></li>
<li class="level2"><a href="#upgrade_occt700_userdraw">UserDraw and Visual3d</a></li>
<li class="level2"><a href="#upgrade_occt700_localcontext">Deprecation of Local Context</a></li>
<li class="level2"><a href="#upgrade_occt700_separate_caf_visualisation">Separation of visualization part from TKCAF</a></li>
<li class="level2"><a href="#upgrade_euler_angles">Correction of interpretation of Euler angles in gp_Quaternion</a></li>
<li class="level2"><a href="#upgrade_zoom_persistent_selection">Zoom Persistent Selection</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="upgrade_intro"></a>
Introduction</h1>
<p>This document provides technical details on changes made in particular versions of OCCT. It can help to upgrade user applications based on previous versions of OCCT to newer ones.</p>
<h2><a class="anchor" id="upgrade_intro_precautions"></a>
Precautions</h2>
<p>Back-up your code before the upgrade. We strongly recommend using version control system during the upgrade process and saving one or several commits at each step of upgrade, until the overall result is verified. This will facilitate identification and correction of possible problems that can occur at the intermediate steps of upgrade. It is advisable to document each step carefully to be able to repeat it if necessary.</p>
<h2><a class="anchor" id="upgrade_intro_disclaim"></a>
Disclaimer</h2>
<p>This document describes known issues that have been encountered during porting of OCCT and some applications and approaches that have helped to resolve these issues in known cases. It does not pretend to cover all possible migration issues that can appear in your application. Take this document with discretion; apply your expertise and knowledge of your application to ensure the correct result.</p>
<p>The automatic upgrade tool is provided as is, without warranty of any kind, and we explicitly disclaim any liability for possible errors that may appear due to use of this tool. It is your responsibility to ensure that the changes you made in your code are correct. When you upgrade the code by an automatic script, make sure to carefully review the introduced changes at each step before committing them.</p>
<h1><a class="anchor" id="upgrade_65"></a>
Upgrade to OCCT 6.5.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5 requires taking into account the following major changes:</p><ul>
<li>If you are not comfortable with dependence on Intel TBB, FreeImage, or Gl2Ps libraries, you will need to (re)build OCCT with these dependencies disabled.</li>
<li>The low-level format version of OCAF binary and XML persistence has been incremented. Hence, the files saved by OCCT 6.5 to OCAF binary or XML format will not be readable by previous versions of OCCT.</li>
<li>The <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_rep_mesh.html">BRepMesh</a></em> triangulation algorithm has been seriously revised and now tries hard to fulfill the requested deflection and angular tolerance parameters. If you experience any problems with performance or triangulation quality (in particular, display of shapes in shading mode), consider revising the values of these parameters used in your application.</li>
<li>If you were using method <em>ToPixMap()</em> of class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> to get a buffer for passing to Windows API functions (e.g. <em>BitBlt</em>), this will not work anymore. You will need to use method <em>Image_PixMap::AccessBuffer()</em> to get the raw buffer data that can be further passed to WinAPI functions.</li>
<li>As the processing of message gravity parameter in <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_message.html">Message</a></em> package has been improved, some application messages (especially the ones generated by IGES or STEP translators) can be suppressed or new messages appear in the application. Use relevant message level parameter to tune this behavior.</li>
</ul>
<h1><a class="anchor" id="upgrade_651"></a>
Upgrade to OCCT 6.5.1</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.1 requires taking into account the following major changes:</p>
<ul>
<li>Method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure.html#acaeff5a05bd99d34a693c46c16e98436">Graphic3d_Structure::Groups()</a></em> now returns <em>Graphic3d_SequenceOfGroup</em>. If this method has been used, the application code should be updated to iterate another collection type or, if <em>Graphic3d_HSetOfGroup</em> is required, to fill its own collection: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;const Graphic3d_SequenceOfGroup&amp; aGroupsSeq = theStructure.Groups();</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(Graphic3d_HSetOfGroup) aGroupSet = new Graphic3d_HSetOfGroup();</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Standard_Integer aLen = aGroupsSeq.Length();</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;for (Standard_Integer aGr = 1; aGr &lt;= aLen; ++aGr)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; aGroupSet-&gt;Add (aGroupsSeq.Value (aGr));</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div>
</div><!-- fragment --></li>
<li>All occurrences of <em>Select3D_Projector</em> in the application code (if any) should be replaced with <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle(Select3D_Projector)</a></em>.</li>
<li>The code of inheritors of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select3_d___sensitive_entity.html">Select3D_SensitiveEntity</a></em> should be updated if they override <em>Matches()</em> (this is probable, if clipping planes are used).</li>
<li>Constructor for <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___plane.html">V3d_Plane</a></em> has been changed, so the extra argument should be removed if used in the application. It is necessary to add a new plane using method <em>V3d_Viewer::AddPlane()</em> if <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> has been used to manage clipping planes list (this does not affect clipping planes representation). Please, have a look at the source code for new DRAWEXE <em>vclipplane</em> command in <em>ViewerTest_ObjectsCommands.cxx, VClipPlane</em> to see how clipping planes can be managed in the application.</li>
</ul>
<h1><a class="anchor" id="upgrade_652"></a>
Upgrade to OCCT 6.5.2</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.2 requires taking into account the following major changes:</p><ul>
<li>Any code that has been generated by WOK from CDL generic classes <em>Tcollection_DataMap</em> and <em>Tcollection_IndexedDataMap</em> needs to be regenerated by WOK to take into account the change in the interface of these classes.</li>
<li>The enumerations <em>CDF_StoreStatus</em> and <em>CDF_RetrievableStatus</em> have been replaced by the enumerations <em>PCDM_StoreStatus</em> and <em>PCDM_ReaderStatus</em>. Correspondingly, the methods <em>Open, Save</em> and <em>SaveAs</em> of the class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_doc_std___application.html">TDocStd_Application</a></em> have changed their return value. Any code, which uses these enumerations, needs to be updated.</li>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_lib___make_face.html">BRepLib_MakeFace</a></em> has been modified to accept tolerance value for resolution of degenerated edges. This tolerance parameter has no default value to ensure that the client code takes care of passing a meaningful value, not just <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_precision.html#a94f8d5777a3e8e1c61bd7bbfa8dfc0eb">Precision::Confusion</a></em>, so some porting overheads are expected.</li>
<li>If the callback mechanism in call_togl_redraw function was used in the application code, it is necessary to revise it to take into account the new callback execution and provide a check of reason value of Aspect_GraphicCallbackStruct in callback methods to confirm that the callback code is executed at the right moment. Now the callbacks are executed before redrawing the underlayer, before redrawing the overlayer and at the end of redrawing. The information about the moment when the callback is invoked is provided with the reason value in form of an additional bit flag <em>(OCC_PRE_REDRAW, OCC_PRE_OVERLAY)</em>. The state of <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_open_gl.html">OpenGl</a> changed in callback methods will not be restored automatically, which might lead to unwanted behavior in redrawing procedure.</li>
<li>The print method used in the application code might need to be revised to take into account the ability to choose between print algorithms: tile and stretch. The stretch algorithm will be selected by default during porting.</li>
<li>It is recommended to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html">BRepMesh_DiscretFactory</a></em> users, to check <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html#aef8bba4de9eb3a365f95acd6cdb57a52">BRepMesh_DiscretFactory::SetDefault()</a></em> return value to determine plugin availability / validity. <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html#aab1481c2e5e960979d629bcd1cdf4271">BRepMesh_DiscretFactory::Discret()</a></em> method now returns handle instead of pointer. The code should be updated in the following manner: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(BRepMesh_DiscretRoot) aMeshAlgo = BRepMesh_DiscretFactory::Get().Discret (theShape, theDeflection, theAngularToler);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; if (!aMeshAlgo.IsNull())  {}</div>
</div><!-- fragment --></li>
<li>The default state of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_rep_mesh.html">BRepMesh</a></em> parallelization has been turned off. The user should switch this flag explicitly:<ul>
<li>by using methods <em>BRepMesh_IncrementalMesh::SetParallel(Standard_True)</em> for each <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___incremental_mesh.html">BRepMesh_IncrementalMesh</a></em> instance before <em>Perform()</em>;</li>
<li>by calling <em>BRepMesh_IncrementalMesh::SetParallelDefault(Standard_True)</em> when <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html">BRepMesh_DiscretFactory</a></em> is used to retrieve the meshing tool (this also affects auto-triangulation in <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a></em>).</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_653"></a>
Upgrade to OCCT 6.5.3</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.3 requires taking into account the following major changes:</p><ul>
<li>As a result of code clean-up and redesign of <em>TKOpenGl</em> driver, some obsolete functions and rendering primitives <em>(TriangleMesh, TriangleSet, Bezier, Polyline, Polygon, PolygonHoles, QuadrangleMesh</em> and <em>QuadrangleSet</em>) have been removed. Instead, the application developers should use primitive arrays that provide the same functionality but are hardware-accelerated. The details can be found in OCCT Visualization User's Guide, “Primitive Arrays” chapter.</li>
<li>Applications should not call <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html#aede01b8961416a8997587b5fc550048a">AIS_InteractiveObject::SetPolygonOffsets()</a></em> method for an instance of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___textured_shape.html">AIS_TexturedShape</a></em> class after it has been added to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em>. More generally, modification of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___aspect_fill_area3d.html">Graphic3d_AspectFillArea3d</a></em> parameters for the computed groups of any <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em> subclass that uses texture mapping should be avoided, because this results in broken texture mapping (see issue 23118). It is still possible to apply non-default polygon offsets to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___textured_shape.html">AIS_TexturedShape</a></em> by calling <em>SetPolygonOffsets()</em> before displaying the shape.</li>
<li>The applications that might have used internal functions provided by <em>TKOpenGl</em> or removed primitives will need to be updated.</li>
<li>In connection with the implementation of Z-layers it might be necessary to revise the application code or revise the custom direct descendant classes of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___graphic_driver.html">Graphic3d_GraphicDriver</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure_manager.html">Graphic3d_StructureManager</a></em> to use the Z-layer feature.</li>
<li>Global variables <em>Standard_PI</em> and <em>PI</em> have been eliminated (use macro <em>M_PI</em> instead).</li>
<li>Method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_vrml_data___node_8hxx.html#aa161f34d6f7c3678dfdf3fd30dcab1ee">HashCode()</a></em> has been removed from class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___transient.html">Standard_Transient</a></em>. It is advisable to use global function <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_vrml_data___node_8hxx.html#aa161f34d6f7c3678dfdf3fd30dcab1ee">HashCode()</a></em> for Handle objects instead.</li>
<li>Declaration of operators new/delete for classes has become consistent and is encapsulated in macros.</li>
<li>Memory management has been changed to use standard heap <em>(MMGT_OPT=0)</em> and reentrant mode <em>(MMGT_REENTRANT=1)</em> by default.</li>
<li>Map classes in <em>NCollection</em> package now accept one more argument defining a hash tool.</li>
</ul>
<h1><a class="anchor" id="upgrade_654"></a>
Upgrade to OCCT 6.5.4</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.4 requires taking into account the following major changes:</p><ul>
<li>The code using obsolete classes <em>Aspect_PixMap, Xw_PixMap</em> and <em>WNT_PixMap</em> should be rewritten implementing class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em>, which is now retrieved by <em>ToPixMap</em> methods as argument. A sample code using <em>ToPixMap</em> is given below: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &lt;Image_AlienPixMap.hxx&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;void dump (Handle(V3d_View)&amp; theView3D)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  Standard_Integer aWndSizeX = 0;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  Standard_Integer aWndSizeY = 0;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  theView3D-&gt;Window()-&gt;Size (aWndSizeX, aWndSizeY);</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  Image_AlienPixMap aPixMap;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  theView3D-&gt;ToPixMap (aPixMap, aWndSizeX, aWndSizeY);</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  aPixMap.Save (&quot;c:\\image.png&quot;);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div>
</div><!-- fragment --></li>
<li>Now OpenGL resources related to Interactive Objects are automatically freed when the last view (window) is removed from graphical driver. To avoid presentation data loss, the application should replace an old view with a new one in the proper order: first the new view is created and activated and only then the old one is detached and removed.</li>
<li>It is recommended to use <em>NCollection</em> containers with hasher parameter (introduced in 6.5.3) instead of global definition <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_vrml_data___node_8hxx.html#a7aa25b13306dbce70d3b6b186e9ab585">IsEqual()</a>/HashCode()</em> as well as to use explicit namespaces to avoid name collision.</li>
</ul>
<h1><a class="anchor" id="upgrade_660"></a>
Upgrade to OCCT 6.6.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.6.0 requires taking into account the following major changes:</p><ul>
<li>Due to the changes in the implementation of Boolean Operations, the order of sub-shapes resulting from the same operation performed with OCCT 6.5.x and OCCT 6.6.0 can be different. It is necessary to introduce the corresponding changes in the applications for which the order of sub-shapes resulting from a Boolean operation is important. It is strongly recommended to use identification methods not relying on the order of sub-shapes (e.g. OCAF naming).</li>
<li>If you need to use OCCT on Mac OS X with X11 (without Cocoa), build OCCT with defined pre-processor macro <em>CSF_MAC_USE_GLX11</em>. XLib front-end (previously the only way for unofficial OCCT builds on Mac OS X) is now disabled by default on this platform. If your application has no support for Cocoa framework you may build OCCT with XLib front-end adding <em>MACOSX_USE_GLX</em> macro to compiler options (you may check the appropriate option in WOK configuration GUI and in CMake configuration). Notice that XQuartz (XLib implementation for Mac OS X) now is an optional component and does not provide a sufficient level of integrity with native (Cocoa-based) applications in the system. It is not possible to build OCCT with both XLib and Cocoa at the same time due to symbols conflict in OpenGL functions.</li>
<li>Animation mode and degeneration presentation mode (simplified presentation for animation) and associated methods have been removed from 3D viewer functionality. Correspondingly, the code using methods <em>SetAnimationModeOn(), SetAnimationModeOff(), AnimationModeIsOn(), AnimationMode(), Tumble(), SetDegenerateModeOn(), SetDegenerateModeOff()</em> and <em>DegenerateModeIsOn()</em> of classes <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> and <em>Visual3d_View</em> will need to be removed or redesigned. Please, notice that Hidden Line Removal presentation was not affected; however, the old code that used methods <em>V3d_View::SetDegenerateModeOn</em> or <em>V3d_View::SetDegenerateModeOff</em> to control HLR presentation should be updated to use <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#aa08a43ab1863e1fd5b27108fad63f341">V3d_View::SetComputedMode</a></em> method instead.</li>
<li>Calls of <em>Graphic3d_Group::BeginPrimitives()</em> and <em>Graphic3d_Group::EndPrimitives()</em> should be removed from the application code.</li>
<li>Application functionality for drawing 2D graphics that was formerly based on <em>TKV2d</em> API should be migrated to <em>TKV3d</em> API. The following changes are recommended for this migration:<ul>
<li>A 2D view can be implemented as a <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> instance belonging to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> managed by <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em> instance. To turn <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> into a 2D view, the necessary view orientation should be set up at the view initialization stage using <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a28a53eae40a7e9457a3fcefdea017284">V3d_View::SetProj()</a></em> method, and view rotation methods simply should not be called.</li>
<li>Any 2D graphic entity (formerly represented with <em>AIS2D_InteractiveObject</em>) should become a class derived from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em> base. These entities should be manipulated in a view using <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em> class API.</li>
<li>All drawing code should be put into <em>Compute()</em> virtual method of a custom interactive object class and use API of <em>Graphic3d</em> package. In particular, all geometry should be drawn using class hierarchy derived from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___array_of_primitives.html">Graphic3d_ArrayOfPrimitives</a></em>. Normally, the Z coordinate for 2D geometry should be constant, unless the application implements some advanced 2D drawing techniques like e.g. multiple "Z layers" of drawings.</li>
<li>Interactive selection of 2D presentations should be set up inside <em>ComputeSelection()</em> virtual method of a custom interactive object class, using standard sensitive entities from <em>Select3D</em> package and standard or custom entity owners derived from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___entity_owner.html">SelectMgr_EntityOwner</a></em> base. Please refer to the Visualization User's Guide for further details concerning OCCT 3D visualization and selection classes. See also <em>Viewer2D</em> OCCT sample application, which shows how 2D drawing can be implemented using TKV3d API.</li>
</ul>
</li>
<li>Run-time graphic driver library loading mechanism based on <em>CSF_GraphicShr</em> environment variable usage has been replaced by explicit linking against <em>TKOpenGl</em> library. The code sample below shows how the graphic driver should be created and initialized in the application code: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// initialize a new viewer with OpenGl graphic driver</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(Graphic3d_GraphicDriver) aGraphicDriver = </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;new OpenGl_GraphicDriver (&quot;TKOpenGl&quot;);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  aGraphicDriver-&gt;Begin (new Aspect_DisplayConnection());</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  TCollection_ExtendedString aNameOfViewer (&quot;Visu3D&quot;);</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  Handle(V3d_Viewer) aViewer </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;= new V3d_Viewer (aGraphicDriver, aNameOfViewer.ToExtString());</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  aViewer-&gt;Init();</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;// create a new window or a wrapper over the existing window, </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;// provided by a 3rd-party framework (Qt, MFC, C# or Cocoa)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;#if defined(_WIN32) || defined(__WIN32__)</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  Aspect_Handle aWindowHandle = (Aspect_Handle )winId();</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  Handle(WNT_Window) aWindow = new WNT_Window (winId());</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;#elif defined(__APPLE__) &amp;&amp; !defined(MACOSX_USE_GLX)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  NSView* aViewHandle = (NSView* )winId();</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  Handle(Cocoa_Window) aWindow = new Cocoa_Window (aViewHandle);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;#else</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; Aspect_Handle aWindowHandle = (Aspect_Handle )winId();</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  Handle(Xw_Window) aWindow = </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;     new Xw_Window (aGraphicDriver-&gt;GetDisplayConnection(), aWindowHandle);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#endif // WNT</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;// setup the window for a new view</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  Handle(V3d_View) aView = aViewer-&gt;CreateView();</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  aView-&gt;SetWindow (aWindow);</div>
</div><!-- fragment --></li>
<li>The following changes should be made in the application-specific implementations of texture aspect:<ul>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___texture_root.html">Graphic3d_TextureRoot</a></em> inheritors now should return texture image by overloading of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___texture_root.html#a57754b6260d9585547616e789f3558de">Graphic3d_TextureRoot::GetImage()</a></em> method instead of the old logic.</li>
<li>Now you can decide if the application should store the image copy as a field of property or reload it dynamically each time (to optimize the memory usage). The default implementation (which loads the image content from the provided file path) does not hold an extra copy since it will be uploaded to the graphic memory when first used.</li>
<li>Notice that the image itself should be created within <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em> class from <em>AlienImage</em> package, while <em>Image_Image</em> class is no more supported and will be removed in the next OCCT release.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_670"></a>
Upgrade to OCCT 6.7.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.7.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_670_clipping"></a>
Object-level clipping and capping algorithm.</h2>
<ul>
<li>It might be necessary to revise and port code related to management of view-level clipping to use <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___clip_plane.html">Graphic3d_ClipPlane</a></em> instead of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___plane.html">V3d_Plane</a></em> instances. Please note that <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___plane.html">V3d_Plane</a></em> class has been preserved &ndash; as previously, it can be used as plane representation. Another approach to represent <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___clip_plane.html">Graphic3d_ClipPlane</a></em> in a view is to use custom presentable object.</li>
<li>The list of arguments of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select3_d___sensitive_entity.html#a0a772ed0a6c442ffb35f410c156b1477">Select3D_SensitiveEntity::Matches()</a></em> method for picking detection has changed. Since now, for correct selection clipping, the implementations should perform a depth clipping check and return (as output argument) minimum depth value found at the detected part of sensitive. Please refer to CDL / Doxygen documentation to find descriptive hints and snippets.</li>
<li><em>Select3D_SensitiveEntity::ComputeDepth()</em> abstract method has been removed. Custom implementations should provide depth checks by method <em>Matches()</em> instead &ndash; all data required for it is available within a scope of single method.</li>
<li>It might be necessary to revise the code of custom sensitive entities and port <em>Matches()</em> and <em>ComputeDepth()</em> methods to ensure proper selection clipping. Please note that obsolete signature of <em>Matches</em> is not used anymore by the selector. If your class inheriting <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select3_d___sensitive_entity.html">Select3D_SensitiveEntity</a></em> redefines the method with old signature the code should not compile as the return type has been changed. This is done to prevent override of removed methods.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_markers"></a>
Redesign of markers presentation</h2>
<ul>
<li>Due to the redesign of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___aspect_marker3d.html">Graphic3d_AspectMarker3d</a></em> class the code of custom markers initialization should be updated. Notice that you can reuse old markers definition code as <em>TColStd_HArray1OfByte</em>; however, <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em> is now the preferred way (and supports full-color images on modern hardware).</li>
<li>Logics and arguments of methods <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#ae6a27f7c869669d0c8807887ad85d0dd">AIS_InteractiveContext::Erase()</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#ac5a131caacbefc500e8a7d78091e57e8">AIS_InteractiveContext::EraseAll()</a></em> have been changed. Now these methods do not remove resources from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure.html">Graphic3d_Structure</a></em>; they simply change the visibility flag in it. Therefore, the code that deletes and reсomputes resources should be revised.</li>
<li><em>Graphic3d_Group::MarkerSet()</em> has been removed. <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html#a008b00a842d93d8d987734389bd9b91b">Graphic3d_Group::AddPrimitiveArray()</a></em> should be used instead to specify marker(s) array.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_views"></a>
Default views are not created automatically</h2>
<p>As the obsolete methods <em>Init(), DefaultOrthographicView()</em> and <em>DefaultPerspectiveView()</em> have been removed from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> class, the two default views are no longer created automatically. It is obligatory to create <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> instances explicitly, either directly by operator new or by calling <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html#ab1c7d60aba29f1fd91195e668d6aaeba">V3d_Viewer::CreateView()</a></em>.</p>
<p>The call <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html#a6f326234b8d42732a8489e9291ede675">V3d_Viewer::SetDefaultLights()</a></em> should also be done explicitly at the application level, if the application prefers to use the default light source configuration. Otherwise, the application itself should set up the light sources to obtain a correct 3D scene.</p>
<h2><a class="anchor" id="upgrade_670_dimensions"></a>
Improved dimensions implementation</h2>
<ul>
<li>It might be necessary to revise and port code related to management of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___length_dimension.html">AIS_LengthDimension</a>, <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___angle_dimension.html">AIS_AngleDimension</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___diameter_dimension.html">AIS_DiameterDimension</a></em> presentations. There is no more need to compute value of dimension and pass it as string to constructor argument. The value is computed internally. The custom value can be set with <em>SetCustomValue()</em> method.</li>
<li>The definition of units and general aspect properties is now provided by <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___dimension_units.html">Prs3d_DimensionUnits</a></em> and <em>Prs3d_DimensionApsect</em> classes.</li>
<li>It might be also necessary to revise code of your application related to usage of <em>AIS_DimensionDisplayMode enumeration</em>. If it used for specifying the selection mode, then it should be replaced by a more appropriate enumeration <em>AIS_DimensionSelectionMode</em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_list_collection"></a>
NCollection_Set replaced by List collection</h2>
<p>It might be necessary to revise your application code, which uses non-ordered <em>Graphic3d_SetOfHClipPlane</em> collection type and replace its occurrences by ordered <em>Graphic3d_SequenceOfHClipPlane</em> collection type.</p>
<h1><a class="anchor" id="upgrade_680"></a>
Upgrade to OCCT 6.8.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.8.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_680_ncollection"></a>
Changes in NCollection classes</h2>
<p>Method <em>Assign()</em> in <em>NCollection</em> classes does not allow any more copying between different collection types. Such copying should be done manually.</p>
<p>List and map classes in <em>NCollection</em> package now require that their items be copy-constructible, but do not require items to have default constructor. Thus the code using <em>NCollection</em> classes for non-copy-constructible objects needs be updated. One option is to provide copy constructor; another possibility is to use Handle or other smart pointer.</p>
<h2><a class="anchor" id="upgrade_680_view_camera"></a>
3D View Camera</h2>
<p>If <em>ViewMapping</em> and <em>ViewOrientation</em> were used directly, this functionality has to be ported to the new camera model. The following methods should be considered as an alternative to the obsolete <em>Visual3d</em> services (all points and directions are supposed to be in world coordinates):</p><ul>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#a1e72ca600d3dcdadce5e571f9ad0622f">Graphic3d_Camera::ViewDimensions()</a></em> or <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a90c4639853c5f8dd7d627f4edca015a0">V3d_View::Size()</a>/ZSize()</em> &ndash; returns view width, height and depth (or "Z size"). Since the view is symmetric now, you can easily compute top, bottom, left and right limits. <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#acee5e52eae4c067fcfb7de593beebbd2">Graphic3d_Camera::ZNear()</a>/ZFar()</em> can be used to obtain the near and far clipping distances with respect to the eye.</li>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#a754b37583a71dd695e5bfdd59a1203dc">Graphic3d_Camera::Up()</a></em> or <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a8a9ebf2e0eb738b27b6ba94c2b1b8c9f">V3d_View::Up()</a></em> &ndash; returns Y direction of the view.</li>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#ac9cb4caad0f973b502d7df0dddb9363d">Graphic3d_Camera::Direction()</a></em> returns the reverse view normal directed from the eye, <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a380395632420ef40b3b903280695ea8d">V3d_View::Proj()</a></em> returns the old-style view normal.</li>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#a7af3bb683ea7a2acd913dc2354ffaf88">Graphic3d_Camera::Eye()</a></em> or <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a33e976aca6c5ef40299ed2a9cf035978">V3d_View::Eye()</a></em> &ndash; returns the camera position (same as projection reference point in old implementation).</li>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#a4ffa2870aef3ceada7df770481b5ef0f">Graphic3d_Camera::Center()</a></em> or <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a1689017cb046e77f9120bd7176b9386f">V3d_View::At()</a></em> &ndash; returns the point the camera looks at (or view reference point according to old terminology).</li>
</ul>
<p>The current perspective model is not fully backward compatible, so the old perspective-related functionality needs to be reviewed.</p>
<p>Please revise application-specific custom presentations to provide proper bounding box. Otherwise object might become erroneously clipped by automatic <em>ZFit</em> or frustum culling algorithms enabled by default.</p>
<h2><a class="anchor" id="upgrade_680_connected_objects"></a>
Redesign of Connected Interactive Objects</h2>
<p>The new implementation of connected Interactive Objects makes it necessary to take the following steps if you use connected Interactive Objects in your application.</p><ul>
<li>Use new <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html">PrsMgr_PresentableObject</a></em> transformation API.</li>
<li>Call <em>RemoveChild()</em> from the original object after connect if you need the original object and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___connected_interactive.html">AIS_ConnectedInteractive</a></em> to move independently.</li>
<li>Access instances of objects connected to <em>AIS_MultiplyConnectedInteractive</em> with <em>Children()</em> method.</li>
<li>For <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html">PrsMgr_PresentableObject</a></em> transformation:<ul>
<li><em>SetLocation (<a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_top_loc___location.html">TopLoc_Location</a>) -&gt; SetLocalTransformation (<a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___trsf.html">gp_Trsf</a>)</em></li>
<li><em>Location -&gt; LocalTransformation</em></li>
<li><em>HasLocation -&gt; HasTransformation</em></li>
<li><em>ResetLocation -&gt; ResetTransformation</em></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="upgrade_680_unicode"></a>
Support of UNICODE Characters</h2>
<p>Support of UNICODE characters introduced in OCCT breaks backward compatibility with applications, which currently use filenames in extended ASCII encoding bound to the current locale. Such applications should be updated to convert such strings to UTF-8 format.</p>
<p>The conversion from UTF-8 to wchar_t is made using little-endian approach. Thus, this code will not work correctly on big-endian platforms. It is needed to complete this in the way similar as it is done for binary persistence (see the macro <em>DO_INVERSE</em> in <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_f_s_d___file_header_8hxx.html">FSD_FileHeader.hxx</a>).</em></p>
<h2><a class="anchor" id="upgrade_680_projection_shift"></a>
Elimination of Projection Shift Concept</h2>
<p>It might be necessary to revise the application code, which deals with <em>Center()</em> method of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em>.</p>
<p>This method was used to pan a <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d.html">V3d</a></em> view by virtually moving the screen center with respect to the projection ray passed through Eye and At points. There is no more need to derive the panning from the Center parameter to get a camera-like eye position and look at the coordinates. <em>Eye()</em> and <em>At()</em> now return these coordinates directly. When porting code dealing with <em>Center()</em>, the parameters <em>Eye()</em> and <em>At()</em> can be adjusted instead. Also <em>V3d_View::SetCenter(Xpix, Ypix)</em> method can be used instead of <em>V3d_View::Center(X, Y)</em> to center the view at the given point. However, if the center coordinates X and Y come from older OCCT releases, calling <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a6d3cfce421a75d1caae0fe9f9581a9ad">V3d_View::Panning</a>(-X, -Y)</em> can be recommended to compensate missing projection shift effect.</p>
<p>There are several changes introduced to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html">Graphic3d_Camera</a></em>. The internal data structure of the camera is based on <em>Standard_Real</em> data types to avoid redundant application-level conversions and precision errors. The transformation matrices now can be evaluated both for <em>Standard_Real</em> and <em>Standard_ShortReal</em> value types. <em>ZNear</em> and <em>ZFar</em> planes can be either negative or positive for orthographic camera projection, providing a trade-off between the camera distance and the range of <em>ZNear</em> or <em>ZFar</em> to reduce difference of exponents of values composing the orientation matrix - to avoid calculation errors. The negative values can be specified to avoid Z-clipping if the reference system of camera goes inside of the model when decreasing camera distance.</p>
<p>The auto z fit mode, since now, has a parameter defining Z-range margin (the one which is usually passed as argument to <em>ZFitAll()</em> method). The methods <em>SetAutoZFitMode(), AutoZFitScaleFactor()</em> and <em>ZFitAll()</em> from class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> deal with the new parameter.</p>
<p>The class <em>Select3D_Projector</em> now supports both orientation and projection transformation matrices, which can be naturally set for the projector. The definition of projector was revised in <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_select___viewer_selector3d.html">StdSelect_ViewerSelector3d</a></em>: perspective and orthographic projection parameters are handled properly. Orthographic projector is based only on direction of projection - no more <em>Center</em> property. This makes it possible to avoid unnecessary re-projection of sensitive while panning, zooming or moving along the projection ray of the view. These operations do not affect the orthographic projection.</p>
<h1><a class="anchor" id="upgrade_690"></a>
Upgrade to OCCT 6.9.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.9.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_690_selection"></a>
Changes in Selection</h2>
<p>Selection mechanism of 3D Viewer has been redesigned to use 3-level <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> tree traverse directly in 3D space instead of projection onto 2D screen space (updated on each rotation). This architectural redesign may require appropriate changes at application level in case if custom Interactive Objects are used.</p>
<h4><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard.html">Standard</a> selection</h4>
<p>Usage of standard OCCT selection entities would require only minor updates.</p>
<p>Custom Interactive Objects should implement new virtual method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___selectable_object.html#afd701c1f91cb47d157347d59de13382b">SelectMgr_SelectableObject::BoundingBox()</a>.</em></p>
<p>Now the method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___selection.html#abda89360609229cebc5dea8087271c5e">SelectMgr_Selection::Sensitive()</a></em> does not return <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html">SelectBasics_SensitiveEntity</a></em>. It returns an instance of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___sensitive_entity.html">SelectMgr_SensitiveEntity</a></em>, which belongs to a different class hierarchy (thus <em>DownCast()</em> will fail). To access base sensitive it is necessary to use method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___sensitive_entity.html#a630c52415842c878bc9fd55261615c5b">SelectMgr_SensitiveEntity::BaseSensitive()</a></em>. For example:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(SelectMgr_Selection) aSelection = anInteractiveObject-&gt;Selection (aMode);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;for (aSelection-&gt;Init(); aSelection-&gt;More(); aSelection-&gt;Next())</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   Handle(SelectBasics_SensitiveEntity) anEntity = aSelection-&gt;Sensitive()-&gt;BaseSensitive();</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
</div><!-- fragment --><h4>Custom sensitive entities</h4>
<p>Custom sensitive entities require more complex changes, since the selection algorithm has been redesigned and requires different output from the entities.</p>
<p>The method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html#a7e4b98d5501f1cbf7994c7cee1fef40f">SelectBasics_SensitiveEntity::Matches()</a></em> of the base class should be overridden following the new signature:</p>
<p><em>Standard_Boolean Matches (<a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___selecting_volume_manager.html">SelectBasics_SelectingVolumeManager</a>&amp; theMgr, <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/struct_select_basics___pick_result.html">SelectBasics_PickResult</a>&amp; thePickResult)</em>, where <em>theMgr</em> contains information about the currently selected frustum or set of frustums (see <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___rectangular_frustum.html">SelectMgr_RectangularFrustum</a>, SelectMgr_TrangularFrustum, <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___triangular_frustum_set.html">SelectMgr_TriangularFrustumSet</a>)</em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/struct_select_basics___pick_result.html">SelectBasics_PickResult</a></em> is an output parameter, containing information about the depth of the detected entity and distance to its center of geometry.</p>
<p>In the overridden method it is necessary to implement an algorithm of overlap and inclusion detection (the active mode is returned by <em>theMgr.IsOverlapAllowed()</em>) with triangular and rectangular frustums.</p>
<p>The depth and distance to the center of geometry must be calculated for the 3D projection of user-picked screen point in the world space. You may use already implemented overlap and inclusion detection methods for different primitives from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___rectangular_frustum.html">SelectMgr_RectangularFrustum</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___triangular_frustum.html">SelectMgr_TriangularFrustum</a></em>, including triangle, point, axis-aligned box, line segment and planar polygon.</p>
<p>Here is an example of overlap/inclusion test for a box:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;if (!theMgr.IsOverlapAllowed()) // check for inclusion</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  Standard_Boolean isInside = Standard_True;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  return theMgr.Overlaps (myBox.CornerMin(), myBox.CornerMax(), &amp;isInside) &amp;&amp; isInside;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Standard_Real aDepth;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;if (!theMgr.Overlaps (myBox, aDepth)) // check for overlap</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  return Standard_False;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;thePickResult =</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;SelectBasics_PickResult (aDepth, theMgr.DistToGeometryCenter (myCenter3d));</div>
</div><!-- fragment --><p>The interface of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html">SelectBasics_SensitiveEntity</a></em> now contains four new pure virtual functions that should be implemented by each custom sensitive:</p><ul>
<li><em>BoundingBox()</em> – returns a bounding box of the entity;</li>
<li><em>Clear()</em> – clears up all the resources and memory allocated for complex sensitive entities;</li>
<li><em>BVH()</em> – builds a <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> tree for complex sensitive entities, if it is needed;</li>
<li><em>NbSubElements()</em> – returns atomic sub-entities of a complex sensitive entity, which will be used as primitives for <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> building. If the entity is simple and no <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> is required, this method returns 1.</li>
</ul>
<p>Each sensitive entity now has its own tolerance, which can be overridden by method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html#aac7bf7a49787f5a55851a830542b968d">SelectBasics_SensitiveEntity::SetSensitivityFactor()</a></em> called from constructor.</p>
<h2><a class="anchor" id="upgrade_690_adaptor3d-curve"></a>
Changes in Adaptor3d_Curve class</h2>
<p>All classes inheriting <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_adaptor3d___curve.html">Adaptor3d_Curve</a></em> (directly or indirectly) must be updated in application code to use new signature of methods <em>Intervals()</em> and <em>NbIntervals()</em>. Note that no compiler warning will be generated if this is not done.</p>
<h2><a class="anchor" id="upgrade_690_v3d_view"></a>
Changes in V3d_View class</h2>
<p>The methods <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#aa8be19a0bf50bbb7c4d0204e00e356de">V3d_View::Convert</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a943047e486680fd9f71cc744906c5453">V3d_View::ConvertWithProj()</a></em> have ceased to return point on the active grid. It might be necessary to revise the code of your application so that <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#ade0719592c3c965ed17b946c3681db0d">V3d_View::ConvertToGrid()</a></em> was called explicitly for the values returned by <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#aa8be19a0bf50bbb7c4d0204e00e356de">V3d_View::Convert</a></em> to get analogous coordinates on the grid. The methods <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#aa8be19a0bf50bbb7c4d0204e00e356de">V3d_View::Convert</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a943047e486680fd9f71cc744906c5453">V3d_View::ConvertWithProj</a></em> convert point into reference plane of the view corresponding to the intersection with the projection plane of the eye/view point vector.</p>
<h1><a class="anchor" id="upgrade_700"></a>
Upgrade to OCCT 7.0.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 7.0.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_700_persist"></a>
Removal of legacy persistence</h2>
<p>Legacy persistence for shapes and OCAF data based on <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_storage___schema.html">Storage_Schema</a></em> (toolkits <em>TKPShape</em>, <em>TKPLCAF</em>, <em>TKPCAF</em>, <em>TKShapeShcema, TLStdLSchema, TKStdSchema</em>, and <em>TKXCAFSchema</em>) has been removed in OCCT 7.0.0. The applications that used these data persistence tools need to be updated to use other persistence mechanisms.</p>
<dl class="section note"><dt>Note</dt><dd>For compatibility with previous versions, possibility to read standard OCAF data (TKLCAF, TKCAF) from the files stored in old format is preserved (toolkits <em>TKStdL</em>, <em>TKStd</em>).</dd></dl>
<p>The existing data files in standard formats can be converted using OCCT 6.9.1 or a previous version, as follows.</p>
<h4>CSFDB files</h4>
<p>Files in CSFDB format (usually with extension .csfdb) contain OCCT shape data that can be converted to BRep format. The easiest way to do that is to use ImportExport sample provided with OCCT 6.9.0 (or earlier):</p>
<ul>
<li>Start ImportExport sample;</li>
<li>Select File / New;</li>
<li>Select File / Import / CSFDB... and specify the file to be converted;</li>
<li>Drag the mouse with the right button pressed across the view to select all shapes by the rectangle;</li>
<li>Select File / Export / BREP... and specify the location and name for the resulting file</li>
</ul>
<h4>OCAF and XCAF documents</h4>
<p>Files containing OCAF data saved in the old format usually have extensions <em>.std, .sgd</em> or <em>.dxc</em> (XDE documents). These files can be converted to XML or binary OCAF formats using DRAW Test Harness commands. Note that if the file contains only attributes defined in TKLCAF and TKCAF, this action can be performed in OCCT 7.0; otherwise OCCT 6.9.1 or earlier should be used.</p>
<p>For that, start <em>DRAWEXE</em> and perform the following commands:</p>
<ul>
<li>To convert <em>*.std</em> and <em>*.sgd</em> file formats to binary format <em>*.cbf</em> (The created document should be in <em>BinOcaf</em> format instead of <em>MDTV-Standard</em>):</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Draw[]&gt; pload ALL</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Draw[]&gt; Open [path to *.std or *.sgd file] Doc</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Draw[]&gt; Format Doc BinOcaf</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Draw[]&gt; SaveAs Doc [path to the new file]</div>
</div><!-- fragment --><ul>
<li>To convert <em>*.dxc</em> file format to binary format <em>*.xbf</em> (The created document should be in <em>BinXCAF</em> format instead of <em>MDTV-XCAF</em>):</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Draw[]&gt; pload ALL</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Draw[]&gt; XOpen [path to *.dxc file] Doc</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Draw[]&gt; Format Doc BinXCAF</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Draw[]&gt; XSave Doc [path to the new file]</div>
</div><!-- fragment --><p>On Windows, it is necessary to replace back slashes in the file path by direct slashes or pairs of back slashes.</p>
<p>Use <em>XmlOcaf</em> or <em>XmlXCAF</em> instead of <em>BinOcaf</em> and <em>BinXCAF</em>, respectively, to save in XML format instead of binary one.</p>
<h2><a class="anchor" id="upgrade_occt700_cdl"></a>
Removal of CDL and WOK</h2>
<p>OCCT code has been completely refactored in version 7.0 to get rid of obsolete technologies used since its inception: CDL (Cas.Cade Definition Language) and WOK (Workshop Organization Kit).</p>
<p>C++ code previously generated by WOK from CDL declarations is now included directly in OCCT sources.</p>
<p>This modification did not change names, API, and behavior of existing OCCT classes, thus in general the code based on OCCT 6.x should compile and work fine with OCCT 7.0. However, due to redesign of basic mechanisms (CDL generic classes, Handles and RTTI) using C++ templates, some changes may be necessary in the code when porting to OCCT 7.0, as described below.</p>
<p>WOK is not necessary anymore for building OCCT from sources, though it still can be used in a traditional way &ndash; auxiliary files required for that are preserved. The recommended method for building OCCT 7.x is CMake, see <a class="el" href="occt_dev_guides__building_cmake.html">Building with CMake</a>. The alternative solution is to use project files generated by OCCT legacy tool <b>genproj</b>, see <a class="el" href="occt_dev_guides__building_msvc.html">Building with MS Visual C++</a>, <a class="el" href="occt_dev_guides__building_code_blocks.html">Building with Code::Blocks</a>, and <a class="el" href="occt_dev_guides__building_xcode.html">Building with Xcode</a>.</p>
<h3><a class="anchor" id="upgrade_occt700_cdl_auto"></a>
Automatic upgrade</h3>
<p>Most of typical changes required for upgrading code for OCCT 7.0 can be done automatically using the <em>upgrade</em> tool included in OCCT 7.0. This tool is a Tcl script, thus Tcl should be available on your workstation to run it.</p>
<p>Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ tclsh</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;% source &lt;path_to_occt&gt;/adm/upgrade.tcl</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;% upgrade -recurse -all -src=&lt;path_to_your_sources&gt;</div>
</div><!-- fragment --><p>On Windows, the helper batch script <em>upgrade.bat</em> can be used, provided that Tcl is either available in <em>PATH</em>, or configured via <em>custom.bat</em> script (for instance, if you use OCCT installed from Windows installer package). Start it from the command prompt:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cmd&gt; &lt;path_to_occt&gt;\upgrade.bat -recurse -all -inc=&lt;path_to_occt&gt;\inc -src=&lt;path_to_your_sources&gt; [options]</div>
</div><!-- fragment --><p>Run the upgrade tool without arguments to see the list of available options.</p>
<p>The upgrade tool performs the following changes in the code.</p>
<ol type="1">
<li><p class="startli">Replaces macro <em>DEFINE_STANDARD_RTTI</em> by <em>DEFINE_STANDARD_RTTIEXT</em>, with second argument indicating base class for the main argument class (if inheritance is recognized by the script): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;DEFINE_STANDARD_RTTI(Class) -&gt; DEFINE_STANDARD_RTTIEXT(Class, Base)</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If macro <em>DEFINE_STANDARD_RTTI</em> with two arguments (used in intermediate development versions of OCCT 7.0) is found, the script will convert it to either <em>DEFINE_STANDARD_RTTIEXT</em> or <em>DEFINE_STANDARD_RTTI_INLINE</em>. The former case is used if current file is header and source file with the same name is found in the same folder. In this case, macro <em>IMPLEMENT_STANDARD_RTTI</em> is injected in the corresponding source file. The latter variant defines all methods for RTTI as inline, and does not require <em>IMPLEMENT_STANDARD_RTTIEXT</em> macro.</dd></dl>
</li>
<li>Replaces forward declarations of collection classes previously generated from CDL generics (defined in <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection.html">TCollection</a></em> package) by inclusion of the corresponding header: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;class TColStd_Array1OfReal; -&gt; #include &lt;TColStd_Array1OfReal.hxx&gt;</div>
</div><!-- fragment --></li>
<li>Replaces underscored names of <em>Handle</em> classes by usage of a macro: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle_Class -&gt; Handle(Class)</div>
</div><!-- fragment --> This change is not applied if the source or header file is recognized as containing the definition of Qt class with signals or slots, to avoid possible compilation errors of MOC files caused by inability of MOC to recognize macros (see <a href="http://doc.qt.io/qt-4.8/signalsandslots.html">http://doc.qt.io/qt-4.8/signalsandslots.html</a>). The file is considered as defining a Qt object if it contains strings <em>Q_OBJECT</em> and either <em>slots:</em> or <em>signals:</em>.</li>
<li>Removes forward declarations of classes with names <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle(C)</a></em> or <em>Handle_C</em>, replacing them either by forward declaration of its argument class, or (for files defining Qt objects) <em>#include</em> statement for a header with the name of the argument class and extension .hxx: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;class Handle(TColStd_HArray1OfReal); -&gt; #include &lt;TColStd_HArray1OfReal.hxx&gt;</div>
</div><!-- fragment --></li>
<li>Removes <em> #includes </em> of files <em>Handle_...hxx</em> that have disappeared in OCCT 7.0: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &lt;Handle_Geom_Curve.hxx&gt; -&gt;</div>
</div><!-- fragment --></li>
<li>Removes <em>typedef</em> statements that use <em>Handle</em> macro to generate the name: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;typedef NCollection_Handle&lt;Message_Msg&gt; Handle(Message_Msg); -&gt;</div>
</div><!-- fragment --></li>
<li>Converts C-style casts applied to Handles into calls to <em>DownCast()</em> method: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;((Handle(A)&amp;)b)     -&gt; Handle(A)::DownCast(b)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;(Handle(A)&amp;)b       -&gt; Handle(A)::DownCast(b)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;(*((Handle(A)*)&amp;b)) -&gt; Handle(A)::DownCast(b)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;*((Handle(A)*)&amp;b)   -&gt; Handle(A)::DownCast(b)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;(*(Handle(A)*)&amp;b)   -&gt; Handle(A)::DownCast(b)</div>
</div><!-- fragment --></li>
<li>Moves <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle()</a></em> macro out of namespace scope: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Namespace::Handle(Class) -&gt; Handle(Namespace::Class)</div>
</div><!-- fragment --></li>
<li>Converts local variables of reference type, which are initialized by a temporary object returned by call to <em>DownCast()</em>, to the variables of non-reference type (to avoid using references to destroyed memory): <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;const Handle(A)&amp; a = Handle(B)::DownCast (b); -&gt; Handle(A) a (Handle(B)::DownCast (b));</div>
</div><!-- fragment --></li>
<li>Adds <em>#include</em> for all classes used as argument to macro <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_8hxx.html#aea8b57a4fa80060017fe460aab588ed8">STANDARD_TYPE()</a></em>, except for already included ones;</li>
<li><p class="startli">Removes uses of obsolete macros <em>IMPLEMENT_DOWNCAST</em> and <em>IMPLEMENT_STANDARD_</em>..., except <em>IMPLEMENT_STANDARD_RTTIEXT</em>.</p>
<dl class="section note"><dt>Note</dt><dd>If you plan to keep compatibility of your code with older versions of OCCT, add option <em>-compat</em> to avoid this change. See also <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_cdl_compat">Preserving compatibility with OCCT 6.x</a>.</dd></dl>
</li>
</ol>
<p>As long as the upgrade routine runs, some information messages are sent to the standard output. In some cases the warnings or errors like the following may appear:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Error in {HEADER_FILE}: Macro DEFINE_STANDARD_RTTI used for class {CLASS_NAME} whose declaration is not found in this file, cannot fix</div>
</div><!-- fragment --><p>Be sure to check carefully all reported errors and warnings, as the corresponding code will likely require manual corrections. In some cases these messages may help you to detect errors in your code, for instance, cases where <em>DEFINE_STANDARD_RTTI</em> macro is used with incorrect class name as an argument.</p>
<h3><a class="anchor" id="upgrade_occt700_cdl_compiler"></a>
Possible compiler errors</h3>
<p>Some situations requiring upgrade cannot be detected and / or handled by the automatic procedure. If you get compiler errors or warnings when trying to build the upgraded code, you will need to fix them manually. The following paragraphs list known situations of this kind.</p>
<h4>Missing header files</h4>
<p>The use of handle objects (construction, comparison using operators == or !=, use of function <em>STANDRAD_TYPE()</em> and method <em>DownCast()</em>) now requires the type of the object pointed by Handle to be completely known at compile time. Thus it may be necessary to include header of the corresponding class to make the code compilable.</p>
<p>For example, the following lines will fail to compile if <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_geom___line_8hxx.html">Geom_Line.hxx</a></em> is not included:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Line) aLine = 0;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;if (aLine != aCurve) {...} </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;if (aCurve-&gt;IsKind(STANDARD_TYPE(Geom_Line)) {...}</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;aLine = Handle(Geom_Line)::DownCast (aCurve);</div>
</div><!-- fragment --><p>Note that it is not necessary to include header of the class to declare Handle to it. However, if you define a class <em>B</em> that uses Handle(<em>A</em>) in its fields, or contains a method returning Handle(<em>A</em>), it is advisable to have header defining <em>A</em> included in the header of <em>B</em>. This will eliminate the need to include the header <em>A</em> in each source file where class <em>B</em> is used.</p>
<h4>Ambiguity of calls to overloaded functions</h4>
<p>This issue appears in the compilers that do not support default arguments in template functions (known cases are Visual C++ 10 and 11): the compiler reports an ambiguity error if a handle is used in the argument of a call to the function that has two or move overloaded versions, accepting handles to different types. The problem is that operator <em> const handle&lt;T2&gt;&amp; </em> is defined for any type <em>T2</em>, thus the compiler cannot make the right choice.</p>
<p>Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;void func (const Handle(Geom_Curve)&amp;);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;void func (const Handle(Geom_Surface)&amp;);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Handle(Geom_TrimmedCurve) aCurve = new Geom_TrimmedCurve (...);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;func (aCurve); // ambiguity error in VC++ 10</div>
</div><!-- fragment --><p>Note that this problem can be avoided in many cases if macro <em>OCCT_HANDLE_NOCAST</em> is used, see <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_cdl_nocast">below</a>.</p>
<p>To resolve this ambiguity, change your code so that argument type should correspond exactly to the function signature. In some cases this can be done by using the relevant type for the corresponding variable, like in the example above:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Curve) aCurve = new Geom_TrimmedCurve (...);  </div>
</div><!-- fragment --><p>Other variants consist in assigning the argument to a local variable of the correct type and using the direct cast or constructor:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;const Handle(Geom_Curve)&amp; aGCurve (aTrimmedCurve);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;func (aGCurve); // OK - argument has exact type</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;func (static_cast(aCurve)); // OK - direct cast </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;func (Handle(Geom_Curve)(aCurve)); // OK - temporary handle is constructed</div>
</div><!-- fragment --><p>Another possibility consists in defining additional template variant of the overloaded function causing ambiguity, and using <em>SFINAE</em> to resolve the ambiguity. This technique can be illustrated by the definition of the template variant of method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_i_g_e_s_data___i_g_e_s_writer.html#a21fe887f63362a15e8344d3b6c2e1f28">IGESData_IGESWriter::Send()</a></em>.</p>
<h4>Lack of implicit cast to base type</h4>
<p>As the cast of a handle to the reference to another handle to the base type has become a user-defined operation, the conversions that require this cast together with another user-defined cast will not be resolved automatically by the compiler.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Geometry) aC = GC_MakeLine (p, v); // compiler error</div>
</div><!-- fragment --><p>The problem is that the class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_g_c_e2d___make_segment.html">GCE2d_MakeSegment</a></em> has a user-defined conversion to <em>const <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle(Geom_TrimmedCurve)</a>&amp;,</em> which is not the same as the type of the local variable <em>aC</em>.</p>
<p>To resolve this, use method <em>Value()</em>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Geometry) aC = GC_MakeLine (p, v).Value(); // ok</div>
</div><!-- fragment --><p>or use variable of the appropriate type:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_TrimmedCurve) aC = GC_MakeLine (p, v); // ok</div>
</div><!-- fragment --><p>With GCC compiler, similar problem appears when const handle to derived type is used to construct handle to base type via assignment (and in some cases in return statement), for instance:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;const Handle(Geom_Line) aLine;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(Geom_Curve) c1 = aLine; // GCC error </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Handle(Geom_Curve) c2 (aLine); // ok</div>
</div><!-- fragment --><p>This problem is specific to GCC and it does not appear if macro <em>OCCT_HANDLE_NOCAST</em> is used, see <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_cdl_nocast">below</a>.</p>
<h4>Incorrect use of STANDARD_TYPE and Handle macros</h4>
<p>You might need to clean your code from incorrect use of macros <em>STANDARD_TYPE</em>() and <em>Handle</em>().</p>
<ol type="1">
<li><p class="startli">Explicit definitions of static functions with names generated by macro <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_8hxx.html#aea8b57a4fa80060017fe460aab588ed8">STANDARD_TYPE()</a></em>, which are artifacts of old implementation of RTTI, should be removed.</p>
<p class="startli">Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;const Handle(Standard_Type)&amp; STANDARD_TYPE(math_GlobOptMin)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  static Handle(Standard_Type) _atype = new Standard_Type (&quot;math_GlobOptMin&quot;, sizeof (math_GlobOptMin));</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  return _atype;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
</div><!-- fragment --></li>
<li><p class="startli">Incorrect location of closing parenthesis of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle()</a></em> macro that was not detectable in OCCT 6.x will cause a compiler error and must be corrected.</p>
<p class="startli">Example (note misplaced closing parenthesis): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;aBSpline = Handle( Geom2d_BSplineCurve::DownCast(BS-&gt;Copy()) );</div>
</div><!-- fragment --></li>
</ol>
<h4>Use of class Standard_AncestorIterator</h4>
<p>Class <em>Standard_AncestorIterator</em> has been removed; use method <em>Parent()</em> of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___type.html">Standard_Type</a></em> class to parse the inheritance chain.</p>
<h4>Absence of cast to Standard_Transient*</h4>
<p>Handles in OCCT 7.0 do not have the operator of conversion to <em>Standard_Transient*,</em> which was present in earlier versions. This is done to prevent possible unintended errors like this:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Line) aLine = ...;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(Geom_Surface) aSurf = ...;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;...</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;if (aLine == aSurf) {...} // will cause a compiler error in OCCT 7.0, but not OCCT 6.x</div>
</div><!-- fragment --><p>The places where this implicit cast has been used should be corrected manually. The typical situation is when Handle is passed to stream:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Line) aLine = ...;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;os &lt;&lt; aLine; // in OCCT 6.9.0, resolves to operator &lt;&lt; (void*) </div>
</div><!-- fragment --><p>Call method <em>get()</em> explicitly to output the address of the Handle.</p>
<h4>Method DownCast for non-base types</h4>
<p>Method <em>DownCast()</em> in OCCT 7.0 is made templated; if it is used with argument which is not a base class, "deprecated" compiler warning is generated. This is done to prevent possible unintended errors like this:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Surface) aSurf = ;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(Geom_Line) aLine = </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  Handle(Geom_Line)::DownCast (aSurf); // will cause a compiler warning in OCCT 7.0, but not OCCT 6.x</div>
</div><!-- fragment --><p>The places where this cast has been used should be corrected manually.</p>
<p>If down casting is used in a template context where argument can have the same or unrelated type so that <em>DownCast()</em> may be not available in all cases, use C++ <em>dynamic_cast&lt;&gt;</em> instead, e.g.:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;template &lt;class T&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;bool CheckLine (const Handle(T) theArg)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  Handle(Geom_Line) aLine = dynamic_cast&lt;Geom_Line&gt; (theArg.get());</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  ...</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div>
</div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_runtime"></a>
Possible runtime problems</h3>
<p>Here is the list of known possible problems at run time after the upgrade to OCCT 7.0.</p>
<h4>References to temporary objects</h4>
<p>In previous versions, the compiler was able to detect the situation when a local variable of a "reference to a Handle" type is initialized by temporary object, and ensured that lifetime of that object is longer than that of the variable. In OCCT 7.0 with default options, it will not work if types of the temporary object and variable are different (due to involvement of user-defined type cast), thus such temporary object will be destroyed immediately.</p>
<p>This problem does not appear if macro <em>OCCT_HANDLE_NOCAST</em> is used during compilation, see below.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// note that DownCast() returns new temporary object!</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;const Handle(Geom_BoundedCurve)&amp; aBC =</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Handle(Geom_TrimmedCurve)::DownCast(aCurve);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;aBC-&gt;Transform (T); // access violation in OCCT 7.0</div>
</div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_nocast"></a>
Option to avoid cast of handle to reference to base type</h3>
<p>In OCCT 6.x and earlier versions the handle classes formed a hierarchy echoing hierarchy of corresponding object classes. This automatically enabled possibility to use handle to derived class in all contexts where handle to base class was needed, e.g. pass it in function by reference without copying:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Standard_Boolean GetCurve (Handle(Geom_Curve)&amp; theCurve);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;....</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Handle(Geom_Line) aLine;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;if (GetCurve (aLine)) {</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  // use aLine, unsafe</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div>
</div><!-- fragment --><p>This feature was used in multiple places in OCCT and dependent projects. However it is potentially unsafe: in the above example no checks are done at compile time or at run time to ensure that argument handle is assigned a type compatible with the type of handle passed as argument. If object of incompatible type (e.g. <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom___circle.html">Geom_Circle</a>) is assigned to <em>theCurve</em>, the behavior will be unpredictable.</p>
<p>For compatibility with existing code, by default OCCT 7.0 keeps this possibility, providing operators of type cast to handle to base type. Besides being unsafe, in specific situations this feature may cause compile-time or run-time errors as described above.</p>
<p>In order to provide safer behavior, this feature can be disabled by defining a compile-time macro <em>OCCT_HANDLE_NOCAST</em>. When it is defined, constructors and assignment operators are defined (instead of type cast operators) to convert from handle to defived type to handle to base type. This implies creation of temporary objects and hence may be more expensive at run time in some circumstances, however this way is more standard, safer, and in general recommended.</p>
<p>The code that relies on possibility of casting to base should be amended so that handle of argument type is always used in function call, and to use DownCast() to safely convert the result to desired type. For instance, the code from the example below can be changed as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(Geom_Line) aLine;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(Geom_Curve) aCurve;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;if (GetCurve (aCure) &amp;&amp; !(aLine = Handle(Geom_Line)::DownCast (aCurve)).IsNull()) {</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  // use aLine safely</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
</div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_compat"></a>
Preserving compatibility with OCCT 6.x</h3>
<p>If you like to preserve the compatibility of your application code with OCCT versions 6.x even after the upgrade to 7.0, consider the following suggestions:</p>
<ol type="1">
<li>If your code used sequences of macros <em>IMPLEMENT_STANDARD_</em>... generated by WOK, replace them by single macro <em>IMPLEMENT_STANDARD_RTTIEXT</em></li>
<li>When running automatic upgrade tool, add option <em>-compat</em>.</li>
<li><p class="startli">Define macros <em>DEFINE_STANDARD_RTTIEXT</em> and <em>DEFINE_STANDARD_RTTI_INLINE</em> when building with previous versions of OCCT, resolving to <em>DEFINE_STANDARD_RTTI</em> with single argument</p>
<p class="startli">Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#if OCC_VERSION_HEX &lt; 0x070000</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  #define DEFINE_STANDARD_RTTIEXT(C1,C2) DEFINE_STANDARD_RTTI(C1)</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  #define DEFINE_STANDARD_RTTI_INLINE(C1,C2) DEFINE_STANDARD_RTTI(C1)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;#endif</div>
</div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="upgrade_occt700_cdl_wok"></a>
Applications based on CDL and WOK</h3>
<p>If your application is essentially based on CDL, and you need to upgrade it to OCCT 7.0, you will very likely need to convert your application code to non-CDL form. This is a non-trivial effort; the required actions would depend strongly on the structure of the code and used CDL features.</p>
<p>The upgrade script and sources of a specialized WOK version used for OCCT code upgrade can be found in WOK Git repository in branch <a href="http://git.dev.opencascade.org/gitweb/?p=occt-wok.git;a=log;h=refs/heads/CR0_700_2">CR0_700_2</a>.</p>
<p><a href="http://www.opencascade.com/contact/">Contact us</a> if you need more help.</p>
<h2><a class="anchor" id="upgrade_occt700_bspline"></a>
Separation of BSpline cache</h2>
<p>Implementation of NURBS curves and surfaces has been revised: the cache of polynomial coefficients, which is used to accelerate calculate values of B-spline, has been separated from data objects <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom2d___b_spline_curve.html">Geom2d_BSplineCurve</a>, <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom___b_spline_curve.html">Geom_BSplineCurve</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom___b_spline_surface.html">Geom_BSplineSurface</a></em> into the dedicated classes <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_spl_c_lib___cache.html">BSplCLib_Cache</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_spl_s_lib___cache.html">BSplSLib_Cache</a></em>.</p>
<p>The benefits of this change are:</p><ul>
<li>Reduced memory footprint of OCCT shapes (up to 20% on some cases)</li>
<li>Possibility to evaluate the same B-Spline concurrently in parallel threads without data races and mutex locks</li>
</ul>
<p>The drawback is that direct evaluation of B-Splines using methods of curves and surfaces becomes slower due to the absence of cache. The slow-down can be avoided by using adaptor classes <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom2d_adaptor___curve.html">Geom2dAdaptor_Curve</a>, <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom_adaptor___curve.html">GeomAdaptor_Curve</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom_adaptor___surface.html">GeomAdaptor_Surface</a></em>, which now use cache when the curve or surface is a B-spline.</p>
<p>OCCT algorithms have been changed to use adaptors for B-spline calculations instead of direct methods for curves and surfaces. The same changes (use of adaptors instead of direct call to curve and surface methods) should be implemented in relevant places in the applications based on OCCT to get the maximum performance.</p>
<h2><a class="anchor" id="upgrade_occt700_booleanresult"></a>
Structural result of Boolean operations</h2>
<p>The result of Boolean operations became structured according to the structure of the input shapes. Therefore it may impact old applications that always iterate on direct children of the result compound assuming to obtain solids as iteration items, regardless of the structure of the input shapes. In order to get always solids as iteration items it is recommended to use <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_top_exp___explorer.html">TopExp_Explorer</a> instead of <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_topo_d_s___iterator.html">TopoDS_Iterator</a>.</p>
<h2><a class="anchor" id="upgrade_occt700_brepextrema"></a>
BRepExtrema_ExtCC finds one solution only</h2>
<p>Extrema computation between non-analytical curves in shape-shape distance calculation algorithm has been changed in order to return only one solution. So, if e.g. two edges are created on parallel b-spline curves the algorithm <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_extrema___dist_shape_shape.html">BRepExtrema_DistShapeShape</a> will return only one solution instead of enormous number of solutions. There is no way to get algorithm working in old manner.</p>
<h2><a class="anchor" id="upgrade_occt700_sorttools"></a>
Removal of SortTools package</h2>
<p>Package <em>SortTools</em> has been removed. The code that used the tools provided by that package should be corrected manually. The recommended approach is to use sorting algorithms provided by STL.</p>
<p>For instance: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &lt;SortTools_StraightInsertionSortOfReal.hxx&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#include &lt;SortTools_ShellSortOfReal.hxx&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#include &lt;TCollection_CompareOfReal.hxx&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;...</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;TCollection_Array1OfReal aValues = ...;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;...</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;TCollection_CompareOfReal aCompReal;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;SortTools_StraightInsertionSortOfReal::Sort(aValues, aCompReal);</div>
</div><!-- fragment --><p> can be replaced by: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &lt;algorithm&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;...</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;TCollection_Array1OfReal aValues = ...;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;...</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;std::stable_sort (aValues.begin(), aValues.end());</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_2dlayers"></a>
On-screen objects and ColorScale</h2>
<p>The old mechanism for rendering Underlay and Overlay on-screen 2D objects based on <em>Visual3d_Layer</em> and immediate drawing model (uncached and thus slow) has been removed. Classes <em>Aspect_Clayer2d, OpenGl_GraphicDriver_Layer, Visual3d_Layer, Visual3d_LayerItem, V3d_LayerMgr</em> and <em>V3d_LayerMgrPointer</em> have been deleted.</p>
<p>General <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a> interactive objects with transformation persistence flag <em>Graphic3d_TMF_2d</em> can be used as a replacement of <em>Visual3d_LayerItem</em>. The anchor point specified for transformation persistence defines the window corner of (or center in case of (0, 0) point). To keep on-screen 2D objects on top of the main screen, they can be assigned to the appropriate Z-layer. Predefined Z-layers <em>Graphic3d_ZLayerId_TopOSD</em> and <em>Graphic3d_ZLayerId_BotOSD</em> are intended to replace Underlay and Overlay layers within the old API.</p>
<p><em>ColorScale</em> object previously implemented using <em>Visual3d_LayerItem</em> has been moved to a new class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___color_scale.html">AIS_ColorScale</a></em>, with width and height specified explicitly. The property of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> storing the global <em>ColorScale</em> object has been removed with associated methods <em>V3d_View::ColorScaleDisplay(), V3d_View::ColorScaleErase(), V3d_View::ColorScaleIsDisplayed()</em> and <em>V3d_View::ColorScale()</em> as well as the classes <em>V3d_ColorScale, V3d_ColorScaleLayerItem</em> and <em>Aspect_ColorScale</em>. Here is an example of creating <em>ColorScale</em> using the updated API:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(AIS_ColorScale) aCS = new AIS_ColorScale();</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;// configuring</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Standard_Integer aWidth, aHeight;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;aView-&gt;Window()-&gt;Size (aWidth, aHeight);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;aCS-&gt;SetSize              (aWidth, aHeight);</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;aCS-&gt;SetRange             (0.0, 10.0);</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;aCS-&gt;SetNumberOfIntervals (10);</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;// displaying</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;aCS-&gt;SetZLayer (Graphic3d_ZLayerId_TopOSD);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;aCS-&gt;SetTransformPersistence (Graphic3d_TMF_2d, gp_Pnt (-1,-1,0));</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;aCS-&gt;SetToUpdate();</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;theContextAIS-&gt;Display (aCS);</div>
</div><!-- fragment --><p>To see how 2d objects are implemented in OCCT you can call <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_draw.html">Draw</a> commands <em>vcolorscale, vlayerline</em> or <em>vdrawtext</em> (with <em>-2d</em> option). <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_draw.html">Draw</a> command <em>vcolorscale</em> now requires the name of <em>ColorScale</em> object as argument. To display this object use command <em>vdisplay</em>. For example:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;pload VISUALIZATION</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;vinit</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;vcolorscale cs -demo</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;pload MODELING</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;box b 100 100 100</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;vdisplay b</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;vsetdispmode 1</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;vfit</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;vlayerline 0 300 300 300 10</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;vdrawtext t &quot;2D-TEXT&quot; -2d -pos 0 150 0 -color red</div>
</div><!-- fragment --><p>Here is a small example in C++ illustrating how to display a custom <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a> object in 2d: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Handle(AIS_InteractiveContext) aContext = ...;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Handle(AIS_InteractiveObject) anObj =...; // create an AIS object</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;anObj-&gt;SetZLayer(Graphic3d_ZLayerId_TopOSD); // display object in overlay</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;anObj-&gt;SetTransformPersistence (Graphic3d_TMF_2d, gp_Pnt (-1,-1,0)); // set 2d flag, coordinate origin is set to down-left corner</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;aContext-&gt;Display (anObj); // display the object</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_userdraw"></a>
UserDraw and Visual3d</h2>
<h4>Visual3d package</h4>
<p>Package <em>Visual3d</em> implementing the intermediate layer between high-level <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d.html">V3d</a></em> classes and low-level <a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_open_gl.html">OpenGl</a> classes for views and graphic structures management has been dropped.</p>
<p>The <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a></em> inherits from the new class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em>. <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em> is an interface class that declares abstract methods for managing displayed structures, display properties and a base layer code that implements computation and management of HLR (or more broadly speaking view-depended) structures.</p>
<p>In the new implementation it takes place of the eliminated <em>Visual3d_View</em>. As before the instance of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em> is still completely managed by <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> classes. It can be accessed through <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> interface but normally it should not be required as all its methods are completely wrapped.</p>
<p>In more details, a concrete specialization of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em> is created and returned by the graphical driver on request. Right after the creation the views are directly used for setting rendering properties and adding graphical structures to be displayed.</p>
<p>The rendering of graphics is possible after mapping a window and activating the view. The direct setting of properties obsoletes the use of intermediate structures with display parameter like <em>Visual3d_ContextView</em>, etc. This means that the whole package <em>Visual3d</em> becomes redundant.</p>
<p>The functionality previously provided by <em>Visual3d</em> package has been redesigned in the following way :</p><ul>
<li>The management of display of structures has been moved from <em>Visual3d_ViewManager</em> into <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure_manager.html">Graphic3d_StructureManager</a></em>.</li>
<li>The class <em>Visual3d_View</em> has been removed. The management of computed structures has been moved into the base layer of <em>Graphi3d_CView</em>.</li>
<li>All intermediate structures for storing view parameters, e.g. <em>Visual3d_ContextView</em>, have been removed. The settings are now kept by instances of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em>.</li>
<li>The intermediate class <em>Visual3d_Light</em> has been removed. All light properties are stored in <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/struct_graphic3d___c_light.html">Graphic3d_CLight</a></em> structure, which is directly accessed by instances of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___light.html">V3d_Light</a></em> classes.</li>
<li>All necessary enumerations have been moved into <em>Graphic3d</em> package.</li>
</ul>
<h4>Custom OpenGL rendering and UserDraw</h4>
<p>Old APIs based on global callback functions for creating <em>UserDraw</em> objects and for performing custom OpenGL rendering within the view have been dropped. <em>UserDraw</em> callbacks are no more required since <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___group.html">OpenGl_Group</a></em> now inherits <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html">Graphic3d_Group</a></em> and thus can be accessed directly from <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;//! Class implementing custom OpenGL element.</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;class UserDrawElement : public OpenGl_Element {};</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;//! Implementation of virtual method AIS_InteractiveObject::Compute().</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;void UserDrawObject::Compute (const Handle(PrsMgr_PresentationManager3d)&amp; thePrsMgr,</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;                              const Handle(Prs3d_Presentation)&amp; thePrs,</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                              const Standard_Integer theMode)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;{</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  Graphic3d_Vec4 aBndMin (myCoords[0], myCoords[1], myCoords[2], 1.0f);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  Graphic3d_Vec4 aBndMax (myCoords[3], myCoords[4], myCoords[5], 1.0f);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  // casting to OpenGl_Group should be always true as far as application uses OpenGl_GraphicDriver for rendering</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  Handle(OpenGl_Group) aGroup = Handle(OpenGl_Group)::DownCast (thePrs-&gt;NewGroup());</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  aGroup-&gt;SetMinMaxValues (aBndMin.x(), aBndMin.y(), aBndMin.z(),</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                           aBndMax.x(), aBndMax.y(), aBndMax.z());</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  UserDrawElement* anElem = new UserDrawElement (this);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  aGroup-&gt;AddElement(anElem);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  // invalidate bounding box of the scene</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  thePrsMgr-&gt;StructureManager()-&gt;Update (thePrsMgr-&gt;StructureManager()-&gt;UpdateMode());</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div>
</div><!-- fragment --><p>To perform a custom OpenGL code within the view, it is necessary to inherit from class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a></em>. See the following code sample:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;//! Custom view.</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;class UserView : public OpenGl_View</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;public:</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  //! Override rendering into the view.</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  virtual void render (Graphic3d_Camera::Projection theProjection,</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                       OpenGl_FrameBuffer*          theReadDrawFbo,</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                       const Standard_Boolean       theToDrawImmediate)</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  {</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    OpenGl_View::render (theProjection, theReadDrawFbo, theToDrawImmediate);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    if (theToDrawImmediate)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    {</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      return;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    }</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    // perform custom drawing</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    const Handle(OpenGl_Context)&amp; aCtx = myWorkspace-&gt;GetGlContext();</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    GLfloat aVerts[3] = { 0.0f, 0,0f, 0,0f };</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    aCtx-&gt;core20-&gt;glEnableClientState(GL_VERTEX_ARRAY);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    aCtx-&gt;core20-&gt;glVertexPointer(3, GL_FLOAT, 0, aVerts);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    aCtx-&gt;core20-&gt;glDrawArrays(GL_POINTS, 0, 1);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    aCtx-&gt;core20-&gt;glDisableClientState(GL_VERTEX_ARRAY);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;};</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;//! Custom driver for creating UserView.</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;class UserDriver : public OpenGl_GraphicDriver</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;public:</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  //! Create instance of own view.</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  virtual Handle(Graphic3d_CView) CreateView (const Handle(Graphic3d_StructureManager)&amp; theMgr) Standard_OVERRIDE</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    Handle(UserView) aView = new UserView (theMgr, this, myCaps, myDeviceLostFlag, &amp;myStateCounter);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    myMapOfView.Add (aView);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    for (TColStd_SequenceOfInteger::Iterator aLayerIt (myLayerSeq); aLayerIt.More(); aLayerIt.Next())</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      const Graphic3d_ZLayerId        aLayerID  = aLayerIt.Value();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      const Graphic3d_ZLayerSettings&amp; aSettings = myMapOfZLayerSettings.Find (aLayerID);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      aView-&gt;AddZLayer         (aLayerID);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      aView-&gt;SetZLayerSettings (aLayerID, aSettings);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    return aView;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;};</div>
</div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_localcontext"></a>
Deprecation of Local Context</h2>
<p>The conception of Local Context has been deprecated. The related classes, e.g. <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___local_context.html">AIS_LocalContext</a></em>, and methods ( <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#ade08e8d7a541e41f53f4802f605b408d">AIS_InteractiveContext::OpenLocalContext()</a></em> and others) will be removed in a future OCCT release.</p>
<p>The main functionality provided by Local Context - selection of object subparts - can be now used within Neutral Point without opening any Local Context.</p>
<h2><a class="anchor" id="upgrade_occt700_separate_caf_visualisation"></a>
Separation of visualization part from TKCAF</h2>
<p>Visualization CAF attributes have been moved into a new toolkit <em>TKVCAF</em>. If your application uses the classes from <em>TPrsStd</em> package then add link to <em>TKVCAF</em> library.</p>
<p>Version numbers of <em>BinOCAF</em> and <em>XmlOCAF</em> formats are incremented; new files cannot be read by earlier versions of OCCT.</p>
<p>Before loading the OCAF files saved by previous versions and containing <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_prs_std___a_i_s_presentation.html">TPrsStd_AISPresentation</a></em> attribute it is necessary to define the environment variable <em>CSF_MIGRATION_TYPES</em>, pointing to file <em>src/StdResources/MigrationSheet.txt</em>. When using documents loaded from a file, make sure to call method <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_prs_std___a_i_s_viewer.html#ae717a74b1983565e9907e198c4818268">TPrsStd_AISViewer::New()</a></em> prior to accessing <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_prs_std___a_i_s_presentation.html">TPrsStd_AISPresentation</a></em> attributes in this document as that method creates them.</p>
<h2><a class="anchor" id="upgrade_euler_angles"></a>
Correction of interpretation of Euler angles in gp_Quaternion</h2>
<p>Conversion of <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___quaternion.html">gp_Quaternion</a></em> to and from intrinsic Tait-Bryan angles (including <em>gp_YawPitchRoll</em>) is fixed.</p>
<p>Before that fix the sequence of rotation axes was opposite to the intended; e.g. <em>gp_YawPitchRoll</em> (equivalent to <em>gp_Intrinsic_ZYX</em>) actually defined intrinsic rotations around X, then Y, then Z. Now the rotations are made in correct order.</p>
<p>Applications that use <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___quaternion.html">gp_Quaternion</a></em> to convert Yaw-Pitch-Roll angles (or other intrinsic Tait-Bryan sequences) may need to be updated to take this change into account.</p>
<h2><a class="anchor" id="upgrade_zoom_persistent_selection"></a>
Zoom Persistent Selection</h2>
<p>Zoom persistent selection introduces a new structure <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___transform_pers.html">Graphic3d_TransformPers</a></em> for transform persistence methods and parameters and a new class <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___world_view_proj_state.html">Graphic3d_WorldViewProjState</a></em> for referring camera transformation state. You might need to update your code to deal with the new classes if you were using the related features. Please, keep in mind the following:</p><ul>
<li><em>Graphic3d_Camera::ModelViewState</em> has been renamed to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#a2686c69d360ba44212f7ce3435cf8201">Graphic3d_Camera::WorldViewState</a></em>.</li>
<li>Transformation matrix utilities from <em>OpenGl_Utils</em> namespace have been moved to <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_graphic3d___transform_utils.html">Graphic3d_TransformUtils</a></em> and <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_graphic3d___transform_utils_8hxx.html">Graphic3d_TransformUtils.hxx</a></em> header respectively.</li>
<li>Matrix stack utilities from <em>OpenGl_Utils</em> namespace have been moved to <em>OpenGl_MatrixStack</em> class and <em>OpenGl_MatrixStack.hxx</em> header respectively.</li>
<li><em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a></em> methods <em>Begin/EndTransformPersistence</em> have been removed. Please, use <em><a class="elRef" doxygen="D:/install/CR0-OCCT7_CR0-OCCT7/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___transform_pers.html#acc4ddee37934d45407c4199f57bf5604">Graphic3d_TransformPers::Apply()</a></em> instead to apply persistence to perspective and world-view projection matrices. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 4 2016 21:57:46 for Open CASCADE Technology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
